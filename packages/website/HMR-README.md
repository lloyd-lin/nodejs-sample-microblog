# Vite 热更新 (HMR) 配置说明

## 概述

本项目已配置了完整的Vite热更新功能，支持React组件的快速刷新和样式热更新。

## 可用的开发命令

### 基础热更新
```bash
npm run vite:dev
# 或
pnpm vite:dev
```

### 增强热更新（推荐）
```bash
npm run dev:hmr
# 或
pnpm dev:hmr
```

### 使用专门的热更新配置
```bash
npm run dev:hmr:config
# 或
pnpm dev:hmr:config
```

### 指定端口和主机
```bash
npm run vite:dev:port    # 指定端口3000
npm run vite:dev:host    # 允许外部访问
```

## 热更新特性

### ✅ 已配置的功能

1. **React Fast Refresh**
   - 组件状态保持
   - 快速组件更新
   - 错误边界支持

2. **CSS热更新**
   - 样式实时更新
   - CSS模块支持
   - 源码映射

3. **文件监听优化**
   - 智能文件过滤
   - 性能优化
   - 忽略不必要的文件

4. **WebSocket连接**
   - 端口：24678
   - 自动重连
   - 错误覆盖层

5. **依赖预构建**
   - 常用库预构建
   - 强制重新构建
   - 缓存优化

### 🔧 配置详情

#### 热更新端口
- 开发服务器：3000
- HMR WebSocket：24678

#### 代理配置
- API代理到：http://localhost:3001
- 支持跨域请求

#### 文件监听
- 忽略：node_modules, dist, .git等
- 监听间隔：100ms
- 不使用轮询（性能优化）

## 使用建议

### 开发时最佳实践

1. **使用增强热更新命令**
   ```bash
   npm run dev:hmr
   ```

2. **检查控制台输出**
   - 确认HMR连接成功
   - 查看代理请求日志

3. **组件开发**
   - 修改组件代码会自动刷新
   - 状态会保持（除非组件重新挂载）

4. **样式开发**
   - CSS修改立即生效
   - 支持CSS模块热更新

### 故障排除

#### 热更新不工作
1. 检查端口是否被占用
2. 确认防火墙设置
3. 重启开发服务器

#### 代理请求失败
1. 确认后端服务运行在3001端口
2. 检查网络连接
3. 查看控制台错误信息

#### 依赖预构建问题
```bash
# 清理缓存并重新构建
rm -rf node_modules/.vite
npm run dev:hmr
```

## 配置文件说明

### vite.config.ts
- 主要配置文件
- 包含生产环境配置

### vite.hmr.config.ts
- 专门的热更新配置
- 更详细的HMR设置
- 开发环境优化

## 性能优化

1. **依赖预构建**
   - React生态预构建
   - 常用UI库预构建
   - 图表库预构建

2. **文件监听优化**
   - 忽略不必要的文件
   - 减少文件系统压力

3. **WebSocket优化**
   - 专用端口
   - 自动重连机制

## 环境变量

开发环境会自动设置：
- `__DEV__: true`
- `__HMR__: true` (仅在使用专门HMR配置时)

## 注意事项

1. 热更新仅在开发环境有效
2. 某些全局状态可能需要手动刷新
3. 大型依赖更新可能需要重启服务器
4. 确保浏览器支持WebSocket 